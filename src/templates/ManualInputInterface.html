<!DOCTYPE html>

<html>
    <head>
        <title>Manual Input Interface</title>

        <!-- Website Icon in Tab Bar -->
        <link rel="icon" href="{{ url_for('static', filename='assets/website_icon.png') }}">

        <!-- Link CSS Stylesheet -->
	    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='LEDInterfaceStyling.css') }}" />
    </head>

    <body>
        <div class="header">
            <!-- Power Icon -->
            <a href="{{ url_for('home') }}" class="headerCell">
		        <img class="headerIconImage" id="powerIcon" src="{{ url_for('static', filename='assets/power_icon_off.svg') }}">
            </a>

            <!-- IP Address -->
            <label id="ipAddress" class="headerCell">
                {{ ipaddress }}
            </label>

            <!-- Home Inferface Icon -->
            <a class="headerCell" href="{{ url_for('home') }}">
		        <img class="headerIconImage" id="homeInterfaceIcon" src="{{ url_for('static', filename='assets/home_icon.svg') }}">
            </a>

            <!-- Manual Interface Icon -->
            <a class="headerCell" href="{{ url_for('manualinput') }}">
		        <img class="headerIconImage" id="manualInterfaceIcon" src="{{ url_for('static', filename='assets/equalizer_icon.svg') }}">
            </a>

            <!-- Code Interface Icon -->
            <a class="headerCell" href="{{ url_for('codeinput') }}">
		        <img class="headerIconImage" id="codeInterfaceIcon" src="{{ url_for('static', filename='assets/code_icon.png') }}">
            </a>

            <!-- Hardware Info Icon -->
            <a class="headerCell" href="{{ url_for('hardwareinformation') }}">
		        <img class="headerIconImage" id="hardwareInfoIcon" src="{{ url_for('static', filename='assets/hardware_information_icon.svg') }}">
            </a>

        </div>

        <div id="sliderContainer"></div>

        <div id="userColorProfileConfig">
            <!-- Add Custom Color Profile -->
            <label for="userColorProfileAddName" id="userColorProfileAddLabel">New Color Profile Name</label>
            <input type="text" id="userColorProfileAddName">
            <input type="submit" id="userColorProfileAddSubmit" value="Add" onclick=addColorProfile()>
            <br>

            <!-- Remove Existing Color Profile -->
            <label for="userColorProfileRemoveSelect" id="userColorProfileRemoveLabel">Remove Color Profile</label>
            <select id="userColorProfileRemoveSelect" onchange=showProfileColor()></select>
            <input type="submit" id="userColorProfileRemoveSubmit" value="Remove" onclick=removeColorProfile()>
        </div>

        <!-- Update RGB Labels -->

	<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>	
        <script type='text/javascript' charset='utf-8'>
            var SliderContainer = document.getElementById("sliderContainer");
            var UserColorProfileColors;

            var socket = io();

	        socket.on('connect', function() {
	  	        console.log("MI Socket Connected");
		        socket.emit("MI Connection");
	        });

	        socket.on('MI Parameters', function(msg) {
                for(var i = 0; i < msg.length; i++){
                    createOption(msg[i]);
                }
                if(document.getElementById('RValue') && document.getElementById('GValue') && document.getElementById('BValue')) {
                    setColor();
                }
	        });

	        socket.on('MI Color Profiles', function(msg) {
	            var select = document.getElementById('userColorProfileRemoveSelect');
	            select.innerHTML = '';

	            // Save the profile's colors for future use
                UserColorProfileColors = msg;

                for(var key in msg) {
                    // Create the new color option
                    var newOption = document.createElement('option');
                    newOption.setAttribute('value', key);
                    newOption.innerHTML = key;

                    // Add the option to the dropdown
                    select.appendChild(newOption);
                }
	        });

	        function removeColorProfile() {
	            if(document.getElementById('RValue') && document.getElementById('GValue') && document.getElementById('BValue')) {
                    var selectBox = document.getElementById('userColorProfileRemoveSelect');
                    var selectBoxValue = selectBox.options[selectBox.selectedIndex].value;
                    selectBox.remove(selectBox.selectedIndex);
                    socket.emit('MI Remove Color Profile', selectBoxValue);
                }
	        }

	        function addColorProfile() {
	            if(document.getElementById('RValue') && document.getElementById('GValue') && document.getElementById('BValue')) {
	                var profileName = document.getElementById('userColorProfileAddName');
	                var rvalue = document.getElementById('RValue').value;
	                var gvalue = document.getElementById('GValue').value;
	                var bvalue = document.getElementById('BValue').value;
	                socket.emit('MI Add Color Profile', [profileName.value, [rvalue, gvalue, bvalue]]);
                    profileName.value = '';
	            }
	        }

	        function showProfileColor() {
	            rvalue = document.getElementById('RValueLabel');
	            gvalue = document.getElementById('GValueLabel');
	            bvalue = document.getElementById('BValueLabel');
	            if(rvalue && gvalue && bvalue) {
	                selectBox = document.getElementById('userColorProfileRemoveSelect')
	                selectBoxSelectedOption = selectBox.options[selectBox.selectedIndex].value;
                    document.getElementById('RValue').value = UserColorProfileColors[selectBoxSelectedOption][0];
                    rvalue.innerHTML = UserColorProfileColors[selectBoxSelectedOption][0]
                    document.getElementById('GValue').value = UserColorProfileColors[selectBoxSelectedOption][1];
                    gvalue.innerHTML = UserColorProfileColors[selectBoxSelectedOption][1]
                    document.getElementById('BValue').value = UserColorProfileColors[selectBoxSelectedOption][2];
                    bvalue.innerHTML = UserColorProfileColors[selectBoxSelectedOption][2]
                    setColor();
                }
	        }

	        function createOption(input) {
                if(input[0] == 'Slider') {
                    var newSlider = document.createElement('input');
                    var newLabel = document.createElement('label');

                    newSlider.setAttribute('class', 'slider');
                    newSlider.setAttribute('id', getDisplayName(input));
                    newSlider.setAttribute('type', 'range');
                    newSlider.setAttribute('min', getValue(newSlider, input[2][0]));
                    newSlider.setAttribute('max', getValue(newSlider, input[2][1]));
                    newSlider.setAttribute('value', getValue(newSlider, input[2][2]));
                    newLabel.setAttribute('id', getDisplayName(input) + 'Label');
                    newLabel.innerHTML = getDisplay(newSlider);

                    newSlider.oninput = function(event) {
                        newLabel.innerHTML = getDisplay(newSlider);

                        if (document.getElementById('RValue') && document.getElementById('GValue') && document.getElementById('BValue')) {
                            setColor();
                        }
		                socket.emit('MI Update Client', formatResponse(event));
                    }

                    SliderContainer.appendChild(newSlider);
                    SliderContainer.appendChild(newLabel);
                }

                if(input[0] == 'Select') {
                    var x
                }
	        }

            function getValue(attribute, value) {
                if(attribute.id == 'Sleep') {
                    return 1000 * value;
                } else {
                    return value;
                }
            }

	        function getDisplay(slider) {
	            if(slider.id == 'Sleep') {
	                return slider.value + 'ms';
	            } else {
	                return slider.value;
	            }
	        }

	        function formatResponse(event) {
                if(event.target.id == 'Sleep') {
                    return [event.target.id, 1.0 * event.target.value / 1000]
                } else {
                    return [event.target.id, event.target.value];
                }
	        }

	        function getDisplayName(input) {
                return input[1];
	        }

            function pad(n){
                return (n.length<2) ? "0"+n : n;
            }

            function setColor() {
                var RHex = parseInt(RValue.value, 10).toString(16),
                    GHex = parseInt(GValue.value, 10).toString(16),
                    BHex = parseInt(BValue.value, 10).toString(16),
                    RGBHex = '#' + pad(RHex) + pad(GHex) + pad(BHex);
                SliderContainer.style.backgroundColor = RGBHex;
            }
        </script>


    </body>
</html>
